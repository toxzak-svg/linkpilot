(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.plugins,l=window.wp.editPost,i=window.wp.components,a=window.wp.data,o=window.wp.element,s=window.wp.i18n,r=window.wp.apiFetch;var c=e.n(r);const m=window.wp.primitives,p=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"M10 17.389H8.444A5.194 5.194 0 1 1 8.444 7H10v1.5H8.444a3.694 3.694 0 0 0 0 7.389H10v1.5ZM14 7h1.556a5.194 5.194 0 0 1 0 10.39H14v-1.5h1.556a3.694 3.694 0 0 0 0-7.39H14V7Zm-4.5 6h5v-1.5h-5V13Z"}));(0,n.registerPlugin)("linkpilot",{render:()=>{const[e,n]=(0,o.useState)(!1),[r,m]=(0,o.useState)(null),[d,u]=(0,o.useState)(null),[g,k]=(0,o.useState)(null),{postId:w,postContent:_}=(0,a.useSelect)(e=>{const t=e("core/editor");return{postId:t.getCurrentPostId(),postContent:t.getEditedPostContent()}},[]),h=(0,o.useCallback)(async()=>{n(!0),k(null),m(null),u(null);try{const e=await c()({path:"/linkpilot/v1/analyze",method:"POST",data:{post_id:w,content:_}});e.success?(m(e.keywords),u(e.suggestions)):k((0,s.__)("Failed to analyze content.","linkpilot"))}catch(e){k(e.message||(0,s.__)("An error occurred while analyzing content.","linkpilot"))}finally{n(!1)}},[w,_]),E=(0,o.useCallback)((e,t)=>{const n=`<a href="${e}">${t}</a>`;if(navigator.clipboard&&navigator.clipboard.write){const t=new Blob([n],{type:"text/html"}),l=new ClipboardItem({"text/html":t});navigator.clipboard.write([l]).then(()=>{y((0,s.__)("Link copied to clipboard!","linkpilot"))}).catch(()=>{navigator.clipboard.writeText(e).then(()=>{y((0,s.__)("URL copied to clipboard!","linkpilot"))})})}else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),y((0,s.__)("URL copied to clipboard!","linkpilot"))}},[]),y=e=>{const t=document.createElement("div");t.className="linkpilot-copied-toast",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},2e3)};return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.PluginSidebarMoreMenuItem,{target:"linkpilot-sidebar",icon:p},(0,s.__)("LinkPilot","linkpilot")),(0,t.createElement)(l.PluginSidebar,{name:"linkpilot-sidebar",title:(0,s.__)("LinkPilot","linkpilot"),icon:p},(0,t.createElement)("div",{className:"linkpilot-panel"},(0,t.createElement)(i.PanelBody,{title:(0,s.__)("Content Analyzer","linkpilot"),initialOpen:!0},(0,t.createElement)("div",{className:"linkpilot-analyze-section"},(0,t.createElement)("p",null,(0,s.__)("Analyze your content to find relevant internal linking opportunities.","linkpilot")),(0,t.createElement)(i.Button,{variant:"primary",onClick:h,disabled:e,className:"linkpilot-analyze-btn"},e?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(i.Spinner,null),(0,s.__)("Analyzing...","linkpilot")):(0,s.__)("Analyze Content","linkpilot")))),e&&(0,t.createElement)("div",{className:"linkpilot-loading"},(0,t.createElement)(i.Spinner,null),(0,s.__)("Scanning content and finding suggestions...","linkpilot")),g&&(0,t.createElement)("div",{className:"linkpilot-error"},(0,t.createElement)("span",{className:"dashicons dashicons-warning"}),(0,t.createElement)("p",null,g)),!e&&!g&&r&&(0,t.createElement)(t.Fragment,null,(()=>{if(!r)return null;const e=[];return r.single_keywords&&Object.entries(r.single_keywords).slice(0,10).forEach(([t,n])=>{e.push({term:t,count:n})}),r.phrases&&Object.entries(r.phrases).slice(0,5).forEach(([t,n])=>{e.push({term:t,count:n,isPhrase:!0})}),0===e.length?null:(0,t.createElement)("div",{className:"linkpilot-keywords-section"},(0,t.createElement)("h4",null,(0,s.__)("Extracted Keywords","linkpilot")),(0,t.createElement)("div",{className:"linkpilot-keywords-list"},e.map((e,n)=>(0,t.createElement)("span",{key:n,className:"linkpilot-keyword-tag"},e.term,(0,t.createElement)("span",{className:"keyword-count"},e.count)))))})(),d?0===d.length?(0,t.createElement)("div",{className:"linkpilot-no-suggestions"},(0,t.createElement)("span",{className:"dashicons dashicons-info-outline"}),(0,t.createElement)("p",null,(0,s.__)("No matching internal links found. Try adding more content or using different keywords.","linkpilot"))):(0,t.createElement)("div",{className:"linkpilot-suggestions-section"},(0,t.createElement)("h4",null,(0,s.__)("Suggested Internal Links","linkpilot")),d.map((e,n)=>(0,t.createElement)("div",{key:e.id,className:"linkpilot-suggestion-card"},(0,t.createElement)("h5",{className:"linkpilot-suggestion-title"},e.title),(0,t.createElement)("div",{className:"linkpilot-suggestion-meta"},(0,t.createElement)("span",{className:"linkpilot-suggestion-type"},e.post_type),(0,t.createElement)("span",{className:"linkpilot-suggestion-score"},(0,t.createElement)("span",{className:"dashicons dashicons-star-filled"}),(0,s.__)("Relevance:","linkpilot")," ",e.score)),e.matching_terms&&e.matching_terms.length>0&&(0,t.createElement)("div",{className:"linkpilot-suggestion-terms"},(0,t.createElement)("strong",null,(0,s.__)("Matching:","linkpilot"))," ",e.matching_terms.join(", ")),(0,t.createElement)("div",{className:"linkpilot-suggestion-actions"},(0,t.createElement)(i.Button,{variant:"secondary",size:"small",onClick:()=>E(e.url,e.title)},(0,s.__)("Copy Link","linkpilot")),(0,t.createElement)(i.ExternalLink,{href:e.url,className:"components-button is-secondary is-small"},(0,s.__)("View","linkpilot")))))):null))))}})})();